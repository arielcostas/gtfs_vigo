# Vigo GTFS

Ariel Costas Guerrero's auto-curated version of the GTFS data for the public transport system in Vigo, Spain.

## Introduction

Concello de Vigo (Vigo's city council, the local administration) provides a GTFS feed generated by Vitrasa, the public bus operator in the city. However, the data misses some important information and contains validation errors according to [MobilityData's GTFS validator](https://gtfs-validator.mobilitydata.org/), which probably prevents it from being used in applications such as Google Maps.

This repository contains a curated version of the GTFS data, downloaded from the [Concello de Vigo's data portal](https://datos-ckan.vigo.org/dataset/gtfs-vitrasa) (download URL is <https://datos.vigo.org/data/transporte/gtfs_vigo.zip>) and processed to fix the issues found by the validator, as well as to add some missing information.

## Current features

- [X] Downloads the GTFS data from the Concello de Vigo's data portal, and uses ETags to avoid downloading it again if it hasn't changed.
- [X] Adds the proper agency phone number and fare information URL to the `agency.txt` file.
- [X] Adds a `feed_info.txt` file with my contact information and this repository's URL.
- [X] In the `stops.txt`, fixes the stop codes to match the numeric IDs used in Vitrasa's system, and adds the URL to the real-time information for each stop.
- [X] Patches the `shapes.txt` file to prevent two `shape_pt_sequence` values with the same `shape_dist_traveled` value, which was causing the validator to fail.
- [X] Adds support for [legacy Fares V1](https://gtfs.org/documentation/schedule/examples/fares-v1/)
- [ ] Adds support for [Fares V2](https://gtfs.org/documentation/schedule/examples/fares/intro/)
- [ ] Add support for [Transfers](https://gtfs.org/documentation/schedule/examples/transfers/) based on the companies' policies, such as _circuitos neutralizados_ and buses that continue as a different line.
- [ ] Polish route long names and trip headsigns to make them more user-friendly (TODO: maybe this would be a problem with realtime solutions relying on the trip headsign?)

## Running the pipeline

This repository is set up with [`uv`](https://docs.astral.sh/uv/) to run the `pipeline.py` script, which downloads the GTFS data and processes it. You can run it with:

```bash
uv run pipeline.py
```

A command-line option is available to force the download of the GTFS data, even if it hasn't changed:

```bash
uv run pipeline.py --force-download
```

## Using the GTFS data

Until I figure out a way to host the GTFS data in a more user-friendly way (either running the pipeline via GitHub Actions and creating release artifacts, or hosting the GTFS data in a web server), you can download this repository as a ZIP and extract the `feed` directory which contains the GTFS data in the standard format.

## Contributing

If you find any issues with the GTFS data, or have suggestions for improvements, please open an issue or a pull request in this repository. Contributions and feedback are welcome!

## Licence

The data in this repository is licensed under the [ODC Attribution License (ODC-By)](https://opendatacommons.org/licenses/by/1-0/), originally by [Concello de Vigo](https://datos-ckan.vigo.org), with the modifications made by [Ariel Costas Guerrero](https://costas.dev) to improve the data quality and usability.

The code included in this repository to curate the GTFS data is licenced under the [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/) licence, because it is similar in spirit to the original data's licence, and I don't care about the code being used anywhere, as long as I'm attributed.
